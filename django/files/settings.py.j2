"""
Django settings for site {{ site.name }}.

Generated by SaltStack.


                    DO NOT MANUALLY EDIT THIS FILE!
        It will  be overwritten at the next synchronization with Salt.

"""

{% for lib in site.settings.get("imports", ["os"]) %}
import {{ lib }}
{% endfor %}

BASE_DIR = os.path.dirname(os.path.dirname(os.path.abspath(__file__)))

# From: https://unix.stackexchange.com/a/230676/
{# Do not add the minus to the set of random chars, it screws the python string. #}
SECRET_KEY = "{{ site.settings.get("SECRET_KEY", salt.cmd.run("< /dev/urandom tr -dc 'A-Za-z0-9%&*+,./:;<=>?@[]^_`{|}~' | head -c 100", python_shell=True)) }}"

DEBUG = {{ site.settings.get("DEBUG", "False") }}

{% if not site.settings.get("ALLOWED_HOSTS") %}
ALLOWED_HOSTS = [{% if site.get("url") %}"{{ "." + site.url }}"{% else %}"{{ salt.cmd.run("curl -s icanhazip.com") }}"{% endif %}]
{% else %}
ALLOWED_HOSTS = {{ site.settings.ALLOWED_HOSTS | python() }}
{% endif %}


INSTALLED_APPS = [
    {% for app in site.settings.get("installed_apps", []) %}
    "{{ app }}",
    {% endfor %}

    "django.contrib.admin",
    "django.contrib.auth",
    "django.contrib.contenttypes",
    "django.contrib.sessions",
    "django.contrib.messages",
    "django.contrib.staticfiles",
]


MIDDLEWARE = [
    {% for mdlw in site.settings.get("middlewares", []) %}
    "{{ mdlw }}",
    {% endfor %}

    "django.middleware.security.SecurityMiddleware",
    "django.contrib.sessions.middleware.SessionMiddleware",
    "django.middleware.common.CommonMiddleware",
    "django.middleware.csrf.CsrfViewMiddleware",
    "django.contrib.auth.middleware.AuthenticationMiddleware",
    "django.contrib.messages.middleware.MessageMiddleware",
    "django.middleware.clickjacking.XFrameOptionsMiddleware",
]

{% if site.settings.get("ROOT_URLCONF") %}ROOT_URLCONF = "{{ site.settings.ROOT_URLCONF }}"{% endif %}

{% if site.settings.get("FORM_RENDERER") %}FORM_RENDERER = "{{ site.settings.FORM_RENDERER }}"{% endif %}

TEMPLATES = [
{% for tmpl in site.settings.get("TEMPLATES", []) %}
    {
    {% for att_name, att_val in tmpl.items() %}
        {% if att_name == "DIRS" %}
        "{{ att_name }}": [{% for dir in att_val %} {{ dir }}, {% endfor %}],
        {% else %}
        "{{ att_name }}": {{ att_val }},
        {% endif %}
    {% endfor %}
    },
{% endfor %}
]

WSGI_APPLICATION = "{{ site.get("wsgi_path", site.settings.get("WSGI_APPLICATION", None)) }}"

DATABASES = {
{% for db_name, db_settings in site.settings.get("DATABASES", {}).items() %}
    "{{ db_name }}": {
    {% for k, v in db_settings.items() %}
        "{{ k }}": {{ v }},
    {% endfor %}
},
{% endfor %}
}

AUTH_PASSWORD_VALIDATORS = {{ site.settings.get("AUTH_PASSWORD_VALIDATORS", []) }}

{% if site.settings.get("LANGUAGE_CODE") %}LANGUAGE_CODE = "{{ site.settings.LANGUAGE_CODE }}"{% endif %}

{% if site.settings.get("USE_I18N") %}USE_I18N = {{ site.settings.USE_I18N }} {% endif %}

{% if site.settings.get("USE_L10N") %}USE_L10N = {{ site.settings.USE_L10N }} {% endif %}

{% if site.settings.get("USE_TZ") %}USE_TZ = {{ site.settings.USE_TZ }} {% endif %}

{% if site.settings.get("TIME_ZONE") %}TIME_ZONE = "{{ site.settings.TIME_ZONE }}"{% endif %}


{% if site.settings.get("STATIC_URL") %}STATIC_URL = "{{ site.settings.get("STATIC_URL") }}"{% endif %}

{% if site.settings.get("AUTH_USER_MODEL") %}AUTH_USER_MODEL = "{{ site.settings.get("AUTH_USER_MODEL") }}"{% endif %}

{% if site.settings.get("LOGIN_URL") %}LOGIN_URL = "{{ site.settings.get("LOGIN_URL") }}"{% endif %}

{% if site.settings.get("LOGIN_REDIRECT_URL") %}LOGIN_REDIRECT_URL = "{{ site.settings.get("LOGIN_REDIRECT_URL") }}"{% endif %}

{% if site.settings.get("STATIC_ROOT") %}STATIC_ROOT = "{{ site.install_dir }}/{{ site.settings.get("STATIC_ROOT") }}"{% endif %}


{% if site.settings.get("STATICFILES_DIRS") %}
STATICFILES_DIRS = [
    {% for dir in site.settings.STATICFILES_DIRS %}
    {{ dir }},
    {% endfor %}
]
{% endif %}


globals().update({{ site.settings.get("OTHER_SETTINGS", {}) }})
